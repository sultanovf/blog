{
  "hash": "6084b1b8eff91fe16649d370ca7e0ea0",
  "result": {
    "markdown": "---\ntitle: \"social network in GIS\"\ndescription: \"plot of share of social network users population in CIS countries using `ggplot2` and `gganimate`\"\nauthor: \"Fazliddin Sultonov\"\ndate: \"2025-03-05\"\ndate-format: \"MMM D, YYYY\"\n\nfilters:\n  - lightbox\nlightbox: \n  match: auto\n  effect: none\n  desc-position: top\n\npage-layout: full\nreference-location: margin\ncategories: [barplot, R, ggplot2, gganimate, ggpol]\n# Code execute options\nexecute: \n  echo: true    # Input anzeigen\n  eval: true    # Code ausführen\n  freeze: true  # never re-render during project render\n# Output\nformat: \n  html:\n    theme: cosmo\n  # codeb block\n    code-fold: true\n    code-line-numbers: true\n    code-block-border-left: true\n  # engine\n    engine: knitr\n    css: /customs/style.css\n# engine: knitr\n#jupyter: python3\n\n# Chunk Options\nknitr:\n  opts_chunk:\n    comment: \"#>\" \n\n  opts_knit: \n    warning: false\n    error: false\n    \n---\n\n\n\n![](gallery_img/socialnetwork.png)\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n\n:::: {.column-screen}\n::: {.code-r}\n# `<svg preserveAspectRatio=\"none\" aria-hidden=\"true\" role=\"img\" viewBox=\"0 0 581 512\" style=\"height:2.0em;width:2.0em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:steelblue;overflow:visible;position:relative;\"><path d=\"M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z\"/></svg>`{=html}{.center-slide}\n\n:::\n::::\n\n\nDatasource: [World Population Review](https://worldpopulationreview.com/) | Internet\n\n\n\n## data\n\n\n::: {.cell .column-screen-inset}\n\n```{.r .cell-code}\ndata_sng <- data.frame(\n  SN = c(\"TikTok\", \"Instagram\", \"Telegram\", \"Facebook\", \"WhatsApp\"),\n  ARM = c(NA, 1.4, NA, 2.3, 0.8),\n  AZE = c(6.1, 4.3, 5.0, 5.1, 2.5),\n  BLR = c(5.6, 3.9, 2.4, 4.3, 2.1),\n  KAZ = c(14.1, 12.4, 12.5, 13.2, 8.0),\n  KGZ = c( 4.9, 2.9, NA, 3.3, 1.6),\n  RUS = c(58.2, 63.0, 35.1, 70.6, 66.7),\n  TJK = c(NA, 1.6, NA, 1.8, 1.4),\n  TKM = c(NA, 0.2, NA, 0.2, 0.6),\n  UZB = c(3.1, 9.4, 18.0, 10.1, 5.1)\n)\n\n\n\nrmarkdown::paged_table(data_sng) # show sample 10 rows\n# oder {r, df_print = \"paged\"}\n# sample_n(data_raw, 10\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"SN\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"ARM\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"AZE\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"BLR\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"KAZ\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"KGZ\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"RUS\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"TJK\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"TKM\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"UZB\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"TikTok\",\"2\":\"NA\",\"3\":\"6.1\",\"4\":\"5.6\",\"5\":\"14.1\",\"6\":\"4.9\",\"7\":\"58.2\",\"8\":\"NA\",\"9\":\"NA\",\"10\":\"3.1\"},{\"1\":\"Instagram\",\"2\":\"1.4\",\"3\":\"4.3\",\"4\":\"3.9\",\"5\":\"12.4\",\"6\":\"2.9\",\"7\":\"63.0\",\"8\":\"1.6\",\"9\":\"0.2\",\"10\":\"9.4\"},{\"1\":\"Telegram\",\"2\":\"NA\",\"3\":\"5.0\",\"4\":\"2.4\",\"5\":\"12.5\",\"6\":\"NA\",\"7\":\"35.1\",\"8\":\"NA\",\"9\":\"NA\",\"10\":\"18.0\"},{\"1\":\"Facebook\",\"2\":\"2.3\",\"3\":\"5.1\",\"4\":\"4.3\",\"5\":\"13.2\",\"6\":\"3.3\",\"7\":\"70.6\",\"8\":\"1.8\",\"9\":\"0.2\",\"10\":\"10.1\"},{\"1\":\"WhatsApp\",\"2\":\"0.8\",\"3\":\"2.5\",\"4\":\"2.1\",\"5\":\"8.0\",\"6\":\"1.6\",\"7\":\"66.7\",\"8\":\"1.4\",\"9\":\"0.6\",\"10\":\"5.1\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n## fill NAs (with column mean)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- \n    data_sng |>\n    mutate(\n        row_nr = row_number()) |> \n  pivot_longer(-c(SN, row_nr),\n    names_to = \"col_id\",\n    values_to = \"val\") |> \n  group_by(col_id) |> \n  mutate(val = ifelse(is.na(val), round(mean(val,na.rm = TRUE),1), round(val,1))) |> \n  pivot_wider(names_from=\"col_id\", values_from = \"val\") |> \n  ungroup()\n\nrmarkdown::paged_table(data)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"SN\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"row_nr\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"ARM\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"AZE\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"BLR\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"KAZ\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"KGZ\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"RUS\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"TJK\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"TKM\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"UZB\"],\"name\":[11],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"TikTok\",\"2\":\"1\",\"3\":\"1.5\",\"4\":\"6.1\",\"5\":\"5.6\",\"6\":\"14.1\",\"7\":\"4.9\",\"8\":\"58.2\",\"9\":\"1.6\",\"10\":\"0.3\",\"11\":\"3.1\"},{\"1\":\"Instagram\",\"2\":\"2\",\"3\":\"1.4\",\"4\":\"4.3\",\"5\":\"3.9\",\"6\":\"12.4\",\"7\":\"2.9\",\"8\":\"63.0\",\"9\":\"1.6\",\"10\":\"0.2\",\"11\":\"9.4\"},{\"1\":\"Telegram\",\"2\":\"3\",\"3\":\"1.5\",\"4\":\"5.0\",\"5\":\"2.4\",\"6\":\"12.5\",\"7\":\"3.2\",\"8\":\"35.1\",\"9\":\"1.6\",\"10\":\"0.3\",\"11\":\"18.0\"},{\"1\":\"Facebook\",\"2\":\"4\",\"3\":\"2.3\",\"4\":\"5.1\",\"5\":\"4.3\",\"6\":\"13.2\",\"7\":\"3.3\",\"8\":\"70.6\",\"9\":\"1.8\",\"10\":\"0.2\",\"11\":\"10.1\"},{\"1\":\"WhatsApp\",\"2\":\"5\",\"3\":\"0.8\",\"4\":\"2.5\",\"5\":\"2.1\",\"6\":\"8.0\",\"7\":\"1.6\",\"8\":\"66.7\",\"9\":\"1.4\",\"10\":\"0.6\",\"11\":\"5.1\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n## proportion of total population\n\n\n::: {.cell}\n\n```{.r .cell-code}\npop <- c(\n  \"ar\" = 2.9, \"az\" = 10.3, \"be\" = 9.1, \"kz\" = 20.6, \"kg\" = 7.2, \n  \"ru\" = 144.8, \"tj\" = 10.6, \"tm\" = 7.5, \"uz\" = 36.4)\n\ndata_pct <-\n  data |>\n  rowwise() |>\n  mutate(\n    ARM = round((ARM/pop[\"ar\"]) *100, 1),\n    AZE = round((AZE/pop[\"az\"]) *100, 1),\n    BLR = round((BLR/pop[\"be\"]) *100, 1),\n    KAZ = round((KAZ/pop[\"kz\"]) *100, 1),\n    KGZ = round((KGZ/pop[\"kg\"]) *100, 1),\n    RUS = round((RUS/pop[\"ru\"]) *100, 1),\n    TJK = round((TJK/pop[\"tj\"]) *100, 1),\n    TKM = round((TKM/pop[\"tm\"]) *100, 1),\n    UZB = round((UZB/pop[\"uz\"]) *100, 1))\n\ndata_pct\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 5 × 11\n#> # Rowwise: \n#>   SN        row_nr   ARM   AZE   BLR   KAZ   KGZ   RUS   TJK   TKM   UZB\n#>   <chr>      <int> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>\n#> 1 TikTok         1  51.7  59.2  61.5  68.4  68.1  40.2  15.1   4     8.5\n#> 2 Instagram      2  48.3  41.7  42.9  60.2  40.3  43.5  15.1   2.7  25.8\n#> 3 Telegram       3  51.7  48.5  26.4  60.7  44.4  24.2  15.1   4    49.5\n#> 4 Facebook       4  79.3  49.5  47.3  64.1  45.8  48.8  17     2.7  27.7\n#> 5 WhatsApp       5  27.6  24.3  23.1  38.8  22.2  46.1  13.2   8    14\n```\n:::\n:::\n\n\n## prepare data for plotting\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_pct$frame <- 1:5\n#data_pct\nfor(i in 1:nrow(data_pct)){\n  data_pct$frame[i] <- list(data_pct$frame[i][[1]]:5)\n}\n#data_pct\ndata_pct <- unnest(data_pct, frame)\n#data_pct\n\n# Data Frame for Plot\ndf_pct <-  gather(data_pct, variable, value, -c(frame, SN, row_nr))\nhead(df_pct)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 6 × 5\n#>   SN        row_nr frame variable value\n#>   <chr>      <int> <int> <chr>    <dbl>\n#> 1 TikTok         1     1 ARM       51.7\n#> 2 TikTok         1     2 ARM       51.7\n#> 3 TikTok         1     3 ARM       51.7\n#> 4 TikTok         1     4 ARM       51.7\n#> 5 TikTok         1     5 ARM       51.7\n#> 6 Instagram      2     2 ARM       48.3\n```\n:::\n:::\n\n\n\n## plotting\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Title/subtitle/datasource\ndata_source <- \"World Population Review | Internet\"\np_title <- \"<br>Часть соцсеть пользователей в общей населения в странах СНГ\"\np_subtitle <- \"\"\n\n# caption\nsocial_caption <- glue::glue(\n  \"<span style = 'color:skyblue3;'><i><strong><br>DataSource: {data_source} <br/></strong></i></span>  Plot by:\n  <span style='color: #C4302B; font-family:\\\"Font Awesome 6 Brands\\\";'>{yt_icon};</span>\n  <span style='color: #C4302B'>{yt_username}</span> |\n  <span style='color: #e1306c; font-family:\\\"Font Awesome 6 Brands\\\";'>{ins_icon};</span>\n  <span style='color: #e1306c'>{ins_username}</span> |\n  <span style='color: #24A1DE; font-family:\\\"Font Awesome 6 Brands\\\";'>{tg_icon};</span>\n  <span style='color: #24A1DE'>{tg_username}<br></span>\"\n)\n\n# caption\nsocial_caption_anim <- glue::glue(\n  \"<span style='color: #C4302B; font-family:\\\"Font Awesome 6 Brands\\\";'>{yt_icon};</span>\n  <span style='color: #C4302B'>{yt_username}</span> |\n  <span style='color: #e1306c; font-family:\\\"Font Awesome 6 Brands\\\";'>{ins_icon};</span>\n  <span style='color: #e1306c'>{ins_username}</span> |\n  <span style='color: #24A1DE; font-family:\\\"Font Awesome 6 Brands\\\";'>{tg_icon};</span>\n  <span style='color: #24A1DE'>{tg_username}<br></span>\"\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# flag image path\nimgpat <- \"gallery_img/flags/\"\ncntry <- c(\n  \"ARM\" = \"AM\", \"AZE\" = \"AZ\", \"BLR\" =\"BY\", \"KAZ\" = \"KZ\", \"KGZ\" =\"KG\", \n  \"RUS\" = \"RU\", \"TJK\" =\"TJ\", \"TKM\" = \"TM\", \"UZB\" = \"UZ\")\n\n# read images\nxlabels <- c()\nfor(i in 1:length(cntry)){\n  imgname <- names(cntry[i])\n  xlabels <- c(xlabels, paste0(\"<img src='\", imgpat, cntry[[i]], \".png' width='50' hight ='25'  /><br>**\", imgname, \"**\"))\n}\n\n# custom color\nmy_color <- c(\"TikTok\" = \"#2AF0EA\", \"Instagram\" = \"#E1306C\", \"Telegram\" = \"#24A1DE\", \"Facebook\" = \"#1877F2\", \"WhatsApp\" = \"#25D366\")\n\n# plot\ngg_pct <- \n  ggplot(data = df_pct, aes(x = variable, y = value, fill = SN)) + \n  geom_bar(stat = \"identity\", position = \"dodge\") +\n  scale_y_continuous(\n    limits = c(0,80 ),\n    breaks = seq(0, 80, 5),\n    labels = function(x) paste0(x,\"%\")) +\n  scale_x_discrete(name = NULL, labels = xlabels) +\n  geom_text(aes(label = as.character(\" \")), vjust = 1, size = 4)+\n  #titles\n  labs(\n    title = p_title, \n    #subtitle = data_source,\n    caption = social_caption,\n    x = NULL, y = NULL) +\n  scale_fill_manual(name = \"Cоцсеть:\", values =  my_color) +\n  # format\n  theme_minimal() +\n  theme(\n    plot.title = element_markdown(size = 16, color = \"steelblue4\", face = \"bold\", hjust = 0.5),\n    plot.caption = ggtext::element_markdown(size=14, hjust = 0.5),\n    axis.text.x = element_markdown(), # x-axis flags\n    axis.line = element_blank(),\n    legend.position = \"top\", legend.direction=\"horizontal\",legend.box = \"horizontal\",\n    panel.border = element_blank(),\n    plot.background = element_rect(fill = \"seashell2\"), #paleturquoise \"seashell1\"\n    panel.background = element_rect(fill = \"ghostwhite\"), #floralwhite\n    panel.grid.minor = element_blank()\n  )\n\n# Show plot\ngg_pct\n```\n\n::: {.cell-output-display}\n![](socialnetwork_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n## animated plot\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngganim_pct <-\n  gg_pct +\n  transition_states(frame, wrap = FALSE, transition_length = 6) +\n  enter_fade()\n\n# animate gif\nanim_pct <- animate(\n  gganim_pct,\n  duration = 10,\n  start_pause =5,\n  end_pause = 10,\n  renderer = gifski_renderer()\n)\n\n# show plot\nanim_pct\n```\n\n::: {.cell-output-display}\n![](socialnetwork_files/figure-html/unnamed-chunk-9-1.gif)\n:::\n:::\n",
    "supporting": [
      "socialnetwork_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}