{
  "hash": "6471a7b0570b7da3da898d3bbe23eb1e",
  "result": {
    "markdown": "---\ntitle: \"barplot via gganimate\"\ndescription: \"`gganimate` extends the grammar of graphics as implemented by ggplot2 to animate of plots.\"\nauthor: \"Fazliddin Sultonov\"\ndate: \"2024-07-01\"\ndate-format: \"MMM D, YYYY\"\n\nfilters:\n  - lightbox\nlightbox: \n  match: auto\n  effect: none\n  desc-position: top\n\npage-layout: full\nreference-location: margin\ncategories: [gganimate, R, ggplot2, barplot]\n# Code execute options\nexecute: \n  echo: true    # Input anzeigen\n  eval: true    # Code ausführen\n  freeze: true  # never re-render during project render\n# Output\nformat: \n  html:\n    theme: cosmo\n    link-external-newwindow: true\n  # codeb block\n    code-fold: true\n    code-line-numbers: true\n    code-block-border-left: true\n  # engine\n    engine: knitr\n    css: /customs/style.css\n\n# Chunk Options\nknitr:\n  opts_chunk:\n    comment: \"#>\" \n\n  opts_knit: \n    warning: false\n    error: false\n    \n---\n\n\n![](gallery_img/gg_bar.png)\n\n\n::: {.cell}\n\n:::\n\n\n## Load data from GitHub\n\nData Source: [worldbank](https://www.worldbank.org/en/home)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- read.csv2(\"https://raw.githubusercontent.com/sultanovf/my_datasets/main/GDP_PerCapita_PPP_19902023.csv\")\nyears <- paste(1990:2023) #, sep=\",\", collapse= \",\"\nyears <- unlist(strsplit(years, \",\"))\nnew_cnames <- c(\"CountryName\", \"CountryCode\",  years)\ncolnames(df) <- new_cnames\n# Country names to plotting\ncountries <- c(\"UAE\", \"Brazil\", \"Switzerland\", \"Germany\", \"France\", \"UK\", \"Indonesia\",\n               \"India\", \"Iran\", \"Iraq\", \"Italy\", \"Kyrgyzstan\", \"Russia\", \"Singapore\", \n               \"Sweden\", \"Tajikistan\", \"Turkiye\", \"USA\", \"Uzbekistan\", \"Kazakhstan\")\n\n# Change some country names\ndf <- df |> \n  rowwise() |> \n  mutate(\n    CountryName = case_when(\n      CountryName == \"United Arab Emirates\" ~ \"UAE\",\n      CountryName == \"Kyrgyz Republic\" ~ \"Kyrgyzstan\",\n      CountryName == \"Iran, Islamic Rep.\" ~ \"Iran\",\n      CountryName == \"Russian Federation\" ~ \"Russia\",\n      CountryName == \"United Kingdom\" ~ \"UK\",\n      CountryName == \"United States\" ~ \"USA\",\n      TRUE ~ CountryName\n    )\n  ) |> \n  filter(\n    CountryName %in% countries\n  ) |> \n  mutate_if(is.numeric, f <- function(x) round(x/1000, 2))\n\ndf |> \n  kable() \n```\n\n::: {.cell-output-display}\n|CountryName |CountryCode |   1990|   1991|   1992|  1993|  1994|   1995|   1996|   1997|  1998|  1999|  2000|  2001|  2002|  2003|   2004|  2005|  2006|  2007|  2008|  2009|  2010|  2011|   2012|   2013|   2014|   2015|   2016|   2017|   2018|   2019|   2020|   2021|   2022|   2023|\n|:-----------|:-----------|------:|------:|------:|-----:|-----:|------:|------:|------:|-----:|-----:|-----:|-----:|-----:|-----:|------:|-----:|-----:|-----:|-----:|-----:|-----:|-----:|------:|------:|------:|------:|------:|------:|------:|------:|------:|------:|------:|------:|\n|UAE         |ARE         | 107.95| 103.01| 101.03| 97.38| 99.37| 101.44| 101.53| 102.91| 97.03| 94.16| 98.71| 94.91| 92.42| 95.81| 100.25| 98.05| 94.11| 81.01| 70.25| 58.20| 55.72| 58.54|  58.99|  61.36|  63.31|  66.99|  70.11|  70.05|  70.41|  70.64|  66.59|  68.91|  73.72|  75.63|\n|Brazil      |BRA         |  12.50|  12.41|  12.14| 12.54| 13.06|  13.40|  13.49|  13.74| 13.59| 13.46| 13.86| 13.87| 14.11| 14.10|  14.75| 15.05| 15.48| 16.25| 16.91| 16.73| 17.82| 18.36|  18.54|  18.93|  18.87|  18.04|  17.31|  17.40|  17.57|  17.65|  16.96|  17.67|  18.12|  18.55|\n|Switzerland |CHE         |  64.59|  63.20|  62.48| 61.84| 62.13|  62.01|  62.03|  63.28| 65.00| 65.77| 67.99| 68.62| 68.06| 67.53|  68.88| 70.32| 72.73| 74.90| 76.04| 73.37| 74.96| 75.48|  75.56|  76.03|  76.88|  77.26|  78.00|  78.33|  79.98|  80.32|  78.02|  81.60|  83.02|  82.91|\n|Germany     |DEU         |  42.57|  44.42|  44.93| 44.20| 45.10|  45.67|  45.90|  46.65| 47.59| 48.45| 49.80| 50.55| 50.36| 49.98|  50.58| 50.98| 52.99| 54.64| 55.27| 52.25| 54.52| 57.72|  57.85|  57.95|  58.98|  59.35|  60.18|  61.56|  61.98|  62.51|  60.07|  61.94|  62.61|  61.91|\n|France      |FRA         |  40.54|  40.61|  41.05| 40.62| 41.42|  42.14|  42.58|  43.42| 44.81| 46.11| 47.59| 48.18| 48.37| 48.43|  49.43| 49.88| 50.75| 51.66| 51.50| 49.77| 50.49| 51.34|  51.26|  51.29|  51.53|  51.92|  52.35|  53.40|  54.20|  55.01|  50.72|  53.83|  54.99|  55.21|\n|UK          |GBR         |  35.55|  35.05|  35.10| 35.88| 37.17|  38.01|  38.89|  40.70| 41.97| 43.11| 44.81| 45.79| 46.42| 47.66|  48.53| 49.52| 50.33| 51.25| 50.73| 48.03| 48.72| 48.89|  49.29|  49.84|  51.05|  51.78|  52.37|  53.40|  53.82|  54.40|  48.58|  52.84|  54.52|  54.13|\n|Indonesia   |IDN         |   4.92|   5.16|   5.40|  5.66|  5.98|   6.37|   6.76|   6.96|  5.95|  5.91|  6.11|  6.25|  6.44|  6.66|   6.90|  7.21|  7.50|  7.88|  8.24|  8.51|  8.93|  9.36|   9.80|  10.22|  10.61|  11.01|  11.44|  11.90|  12.39|  12.90|  12.52|  12.90|  13.50|  14.07|\n|India       |IND         |   2.19|   2.17|   2.24|  2.30|  2.40|   2.53|   2.67|   2.73|  2.84|  3.03|  3.09|  3.19|  3.25|  3.44|   3.66|  3.88|  4.13|  4.38|  4.45|  4.74|  5.07|  5.26|   5.48|   5.75|   6.10|   6.51|   6.97|   7.36|   7.75|   7.96|   7.43|   8.09|   8.59|   9.17|\n|Iran        |IRN         |   9.47|  10.27|  10.36| 10.14|  9.93|  10.03|  10.53|  10.52| 10.57| 10.62| 11.05| 11.13| 11.91| 12.82|  13.16| 13.36| 13.82| 14.73| 14.56| 14.51| 15.14| 15.34|  14.58|  14.15|  14.58|  14.05|  15.01|  15.20|  14.73|  14.12|  14.47|  15.04|  15.50|  16.15|\n|Iraq        |IRQ         |  10.69|   3.80|   4.89|  6.08|  6.01|   5.93|   6.38|   7.49|  9.79| 11.14| 12.60| 12.42| 11.04|  6.78|  10.11|  9.98| 10.46| 10.75| 11.41| 11.38| 11.73| 12.19|  13.27|  13.64|  13.19|  13.45|  14.93|  14.31|  14.34|  14.78|  12.69|  12.60|  13.27|  12.59|\n|Italy       |ITA         |  42.90|  43.53|  43.86| 43.46| 44.38|  45.66|  46.23|  47.05| 47.89| 48.66| 50.48| 51.44| 51.49| 51.33|  51.73| 51.89| 52.67| 53.18| 52.32| 49.33| 50.02| 50.29|  48.66|  47.21|  46.78|  47.19|  47.88|  48.75|  49.30|  50.11|  45.84|  49.90|  52.06|  52.70|\n|Kazakhstan  |KAZ         |  17.67|  15.63|  14.81| 13.49| 11.97|  11.21|  11.44|  11.82| 11.80| 12.23| 13.47| 15.32| 16.82| 18.32|  19.94| 21.68| 23.75| 25.57| 25.92| 25.72| 27.21| 28.80|  29.77|  31.10|  31.93|  31.85|  31.74|  32.60|  33.49|  34.55|  33.25|  33.89|  34.19|  35.45|\n|Kyrgyzstan  |KGZ         |   6.10|   5.52|   4.70|  3.97|  3.18|   2.97|   3.14|   3.40|  3.42|  3.49|  3.64|  3.80|  3.76|  3.98|   4.21|  4.16|  4.24|  4.56|  4.89|  4.98|  4.89|  5.12|   5.03|   5.47|   5.58|   5.68|   5.81|   5.96|   6.07|   6.21|   5.66|   5.80|   6.14|   6.40|\n|Russia      |RUS         |  29.95|  28.35|  24.21| 22.12| 19.35|  18.55|  17.88|  18.16| 17.23| 18.39| 20.31| 21.44| 22.55| 24.30|  26.16| 27.94| 30.33| 32.96| 34.69| 31.98| 33.40| 34.80|  36.10|  36.63|  36.22|  35.39|  35.36|  35.93|  36.91|  37.70|  36.75|  38.94|  38.26|  39.75|\n|Singapore   |SGP         |  45.37|  47.05|  48.69| 52.91| 56.97|  59.23|  61.12|  64.01| 60.52| 63.47| 68.02| 65.50| 67.45| 71.57|  77.70| 81.49| 86.09| 90.03| 86.95| 84.48| 95.04| 98.87| 100.75| 103.91| 106.60| 108.48| 110.93| 115.83| 119.34| 119.57| 115.30| 131.86| 132.47| 127.54|\n|Sweden      |SWE         |  39.97|  39.24|  38.56| 37.55| 38.74|  40.06|  40.63|  41.85| 43.63| 45.45| 47.54| 48.10| 48.99| 49.94|  51.90| 53.17| 55.34| 56.82| 56.12| 53.23| 55.92| 57.28|  56.52|  56.71|  57.64|  59.59|  60.07|  60.79|  61.26|  61.84|  60.06|  63.38|  64.62|  64.19|\n|Tajikistan  |TJK         |   4.16|   3.77|   2.63|  2.17|  1.68|   1.45|   1.18|   1.19|  1.24|  1.28|  1.37|  1.47|  1.59|  1.73|   1.88|  1.96|  2.06|  2.18|  2.31|  2.36|  2.46|  2.59|   2.72|   2.86|   2.98|   3.08|   3.22|   3.37|   3.55|   3.73|   3.81|   4.07|   4.31|   4.58|\n|Turkiye     |TUR         |  12.50|  12.37|  12.76| 13.50| 12.65|  13.41|  14.17|  15.00| 15.12| 14.41| 15.18| 14.10| 14.80| 15.45|  16.73| 17.99| 18.99| 19.79| 19.70| 18.50| 19.75| 21.64|  22.39|  23.98|  24.83|  25.99|  26.50|  28.12|  28.58|  28.40|  28.65|  31.64|  33.06|  34.41|\n|USA         |USA         |  44.40|  43.76|  44.68| 45.30| 46.55|  47.24|  48.45|  50.00| 51.64| 53.49| 55.06| 55.04| 55.46| 56.52|  58.15| 59.63| 60.70| 61.33| 60.82| 58.74| 59.82| 60.32|  61.25|  62.11|  63.21|  64.60|  65.30|  66.48|  68.10|  69.46|  67.27|  71.06|  72.17|  73.64|\n|Uzbekistan  |UZB         |   3.81|   3.71|   3.22|  3.07|  2.86|   2.78|   2.77|   2.86|  2.94|  3.03|  3.11|  3.19|  3.28|  3.38|   3.59|  3.79|  4.03|  4.35|  4.66|  4.96|  5.18|  5.43|   5.73|   6.05|   6.36|   6.70|   6.97|   7.16|   7.45|   7.75|   7.75|   8.16|   8.45|   8.77|\n:::\n:::\n\n\n## Pivot table\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ndf_pivot <- df |> \n  pivot_longer(\n    cols = !c(CountryName, CountryCode),\n    names_to = \"Years\",\n    values_to = \"GDPperCap\") |> \n  select(-CountryCode) |> \n  mutate(\n    Years = as.integer(Years),\n    GDPperCap = round(GDPperCap, 2)\n  ) |> \n  group_by(Years ) |> \n  arrange(Years, GDPperCap) |> \n  mutate(rank = 1:n()) |> \n  ungroup()\n#\ndf_pivot |> \n  as.tibble() |> \n  head()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 6 × 4\n#>   CountryName Years GDPperCap  rank\n#>   <chr>       <int>     <dbl> <int>\n#> 1 India        1990      2.19     1\n#> 2 Uzbekistan   1990      3.81     2\n#> 3 Tajikistan   1990      4.16     3\n#> 4 Indonesia    1990      4.92     4\n#> 5 Kyrgyzstan   1990      6.1      5\n#> 6 Iran         1990      9.47     6\n```\n:::\n:::\n\n\n## Barplot\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nplt = ggplot(df_pivot, aes(\n    xmin = 0,\n    xmax = GDPperCap,\n    y = rank,\n    ymin = rank - 0.45,\n    ymax = rank + 0.45,\n    fill = CountryName,\n    label = round(GDPperCap, 0))) +\n  geom_rect(alpha = 0.5) +\n  geom_text(aes(x = GDPperCap, label = as.character(GDPperCap)),size = 2.0, colour = \"steelblue4\", hjust = \"left\") +\n  geom_text(aes(x = 0, label = CountryName),size = 2.5, colour = \"lightsteelblue4\", hjust = \"left\") +\n  scale_x_continuous(limits = c(0,140),breaks = seq(0, 135, 5),\n                     labels = function(x) paste(\"$\", x)) +\n  labs(\n    x = \"ВВП на душу населения, *(в тысячах)*\",\n    y = NULL,\n    title = \"ВВП на душу населения\") +\n  geom_label(aes(label = paste(\"Год:\", Years)),\n             x = 120, y = 2, size = 8, fill = \"white\", col = \"gray\") +\n  theme_classic() +\n  theme(legend.position = \"none\",\n    axis.line.y = element_blank(),\n    axis.text.y = element_blank(),\n    axis.ticks.y = element_blank(),\n    axis.title.y = element_blank(),\n    axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1, size = 10),\n    axis.title.x = element_markdown(color= \"lightskyblue4\", size = 10,),\n    #title = element_text(colour =  \"blue\", size = 10, hjust = 1),\n    plot.title = element_text(colour =  \"steelblue\", size = 15, face = \"bold\", hjust = 0.065)\n    )\n\n  #guides(fill = FALSE)\nplt\n```\n\n::: {.cell-output-display}\n![](gganimate_bar_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n## Animate Plot\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nplt_animat = plt +\n  #geom_text(aes(label = round(GDPperCap, 2)),colour =  \"darkgray\", vjust=-0.5)+\n  facet_wrap(~Years) +\n  facet_null() +\n  transition_time(Years)\n  #labs(title = \"Year: {frame_time}\") \n  # theme(\n  #   title = element_markdown(colour =  \"gray\", size = 20)\n  # )\n\nplt_animat |>\n  animate(\n    duration = 30,\n    fps = 10,\n    start_pause = 10,\n    end_pause = 20,\n  ) -> my_plt\nmy_plt\n```\n\n::: {.cell-output-display}\n![](gganimate_bar_files/figure-html/unnamed-chunk-5-1.gif)\n:::\n:::\n",
    "supporting": [
      "gganimate_bar_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}